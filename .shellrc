# Configure PATH
export PATH=$HOME/.dotfiles/bin:$PATH
export PATH=$HOME/.local/bin:$PATH
export PATH=$HOME/.cargo/bin:$PATH

ipaddr() {
    # https://stackoverflow.com/questions/8529181/which-terminal-command-to-get-just-ip-address-and-nothing-else
    # `| cut -f1` is to remove red color from grep
    ip -4 addr show eth0 | grep -oP '(?<=inet\s)\d+(\.\d+){3}' | cut -f1
}

call_command_with_wsl_path_arguments_translated_to_windows_paths() {
    # Calls command given by $1 with arguments $2 $3 $4 and so on.
    # Arguments that are a valid WSL path to a file are translated to Windows paths.
    # Example:
    # call_command_with_wsl_path_arguments_translated_to_windows_paths firefox.exe ~/example.pdf google.com
    # will open firefox with ~/example.pdf in one tab, and google.com in another.
    COMMAND=$1
    shift 1

    i=0
    for ARGUMENT in "$@"
    do
        if [ -f "$ARGUMENT" ]
        then
            ARGUMENT=$(wslpath -w "$ARGUMENT")
        fi
        if [ $i -eq 0 ]
        then
            set -- "$ARGUMENT"
        else
            set -- "$@" "$ARGUMENT"
        fi
        i=$((i+1))
    done

    "$COMMAND" "$@"
}

call_exe_with_file_argument_wsl() {
    # Calls a .exe file given by $1 with arguments $2 $3 $4 and so on.
    # All paths are automatically translated between Windows and WSL path when necessary.
    EXE_PATH=$1
    shift 1

    if [ ! -f "$EXE_PATH" ]
    then
        EXE_PATH=$(wslpath "$EXE_PATH")
        if [ ! -f "$EXE_PATH" ]
        then
            echo "Couldn't find executable $EXE_PATH" >&2
            exit 1
        fi
    fi

    call_command_with_wsl_path_arguments_translated_to_windows_paths "$EXE_PATH" "$@"
}

alias_if_not_exists() {
    # Registers an alias if $ALIAS_NAME is not already an existing command
    ALIAS_NAME=$1
    shift 1

    if ! command -v $ALIAS_NAME > /dev/null
    then
        alias $ALIAS_NAME="$@"
    fi
}

register_wsl_alias_for_exe() {
    # Registers a WSL compatible alias to a .exe path if $ALIAS_NAME is not already an existing command
    ALIAS_NAME=$1
    shift 1
    EXE_PATH=$1
    alias $ALIAS_NAME="call_exe_with_file_argument_wsl \"$EXE_PATH\""
}

register_wsl_alias_for_exe firefox '/mnt/c/Program Files/Mozilla Firefox/firefox.exe'
register_wsl_alias_for_exe chrome 'C:\Program Files\Google\Chrome\Application\chrome.exe'
register_wsl_alias_for_exe edge 'C:\Program Files (x86)\Microsoft\Edge\Application\msedge.exe'
register_wsl_alias_for_exe paintdotnet 'C:\Program Files\paint.net\paintdotnet.exe'
register_wsl_alias_for_exe adobe 'C:\Program Files\Adobe\Acrobat DC\Acrobat\Acrobat.exe'
register_wsl_alias_for_exe gimp 'C:\Program Files\GIMP 2\bin\gimp-2.10.exe'
register_wsl_alias_for_exe notepad '/mnt/c/Windows/notepad.exe'

alias eog='paintdotnet'

# Alias c to "code ." if vscode is installed
if command -v code > /dev/null
then
    c() {
        if [ "$#" -eq 0 ]
        then
            code .
        else
            code $@
        fi
    }
fi

alias serial="$HOME/.dotfiles/pyserial_interactive_connection.py"
alias restart_wsl_usb_attach_loop="$HOME/.dotfiles/restart_wsl_usb_attach_loop.sh"
alias wsl=sudo "$HOME/.dotfiles/wsl-sudo/wsl-sudo.py"
alias wudo=wsl-sudo
alias e=exa
alias f=firefox

# Source local shellrc last so that it takes priority
if [ -f $HOME/.local.shellrc ]
then
    source $HOME/.local.shellrc
fi
