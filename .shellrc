# Configure PATH
export PATH=$HOME/.local/bin:$PATH

ipaddr() {
    # https://stackoverflow.com/questions/8529181/which-terminal-command-to-get-just-ip-address-and-nothing-else
    # `| cut -f1` is to remove red color from grep
    ip -4 addr show eth0 | grep -oP '(?<=inet\s)\d+(\.\d+){3}' | cut -f1
}

call_command_with_wsl_path_arguments_translated_to_windows_paths() {
    # Calls command given by $1 with arguments $2 $3 $4 and so on.
    # Arguments that are a valid WSL path to a file are translated to Windows paths.
    # Example:
    # call_command_with_wsl_path_arguments_translated_to_windows_paths firefox.exe ~/example.pdf google.com
    # will open firefox with ~/example.pdf in one tab, and google.com in another.
    COMMAND=$1
    shift 1

    i=0
    for ARGUMENT in "$@"
    do
        if [ -f "$ARGUMENT" ]
        then
            ARGUMENT=$(wslpath -w "$ARGUMENT")
        fi
        if [ $i -eq 0 ]
        then
            set -- "$ARGUMENT"
        else
            set -- "$@" "$ARGUMENT"
        fi
        i=$((i+1))
    done

    "$COMMAND" "$@"
}

call_exe_with_file_argument_wsl() {
    # Calls a .exe file given by $1 with arguments $2 $3 $4 and so on.
    # All paths are automatically translated between Windows and WSL path when necessary.
    EXE_PATH=$1
    shift 1

    if [ ! -f "$EXE_PATH" ]
    then
        EXE_PATH=$(wslpath "$EXE_PATH")
        if [ ! -f "$EXE_PATH" ]
        then
            echo "Couldn't find executable $EXE_PATH" >&2
            exit 1
        fi
    fi

    call_command_with_wsl_path_arguments_translated_to_windows_paths "$EXE_PATH" "$@"
}

alias_if_not_exists() {
    # Registers an alias if $ALIAS_NAME is not already an existing command
    ALIAS_NAME=$1
    shift 1

    if ! command -v $ALIAS_NAME > /dev/null
    then
        alias $ALIAS_NAME="$@"
    fi
}

register_wsl_alias_for_exe() {
    # Registers a WSL compatible alias to a .exe path if $ALIAS_NAME is not already an existing command
    ALIAS_NAME=$1
    shift 1
    EXE_PATH=$1
    alias_if_not_exists $ALIAS_NAME "call_exe_with_file_argument_wsl \"$EXE_PATH\""
}

register_wsl_alias_for_exe firefox '/mnt/c/Program Files/Mozilla Firefox/firefox.exe'
register_wsl_alias_for_exe chrome 'C:\Program Files\Google\Chrome\Application\chrome.exe'
register_wsl_alias_for_exe edge 'C:\Program Files (x86)\Microsoft\Edge\Application\msedge.exe'
register_wsl_alias_for_exe paintdotnet 'C:\Program Files\paint.net\paintdotnet.exe'
register_wsl_alias_for_exe word 'C:\Program Files\Microsoft Office\root\Office16\WINWORD.EXE'
register_wsl_alias_for_exe powerpoint 'C:\Program Files\Microsoft Office\root\Office16\POWERPNT.EXE'
register_wsl_alias_for_exe excel 'C:\Program Files\Microsoft Office\root\Office16\EXCEL.EXE'
register_wsl_alias_for_exe outlook 'C:\Program Files\Microsoft Office\root\Office16\OUTLOOK.EXE'
register_wsl_alias_for_exe onedrive 'C:\Program Files\Microsoft OneDrive\OneDrive.exe'
register_wsl_alias_for_exe adobe 'C:\Program Files\Adobe\Acrobat DC\Acrobat\Acrobat.exe'
register_wsl_alias_for_exe gimp 'C:\Program Files\GIMP 2\bin\gimp-2.10.exe'
register_wsl_alias_for_exe notepad '/mnt/c/Windows/notepad.exe'
register_wsl_alias_for_exe ucterm 'C:\Users\sigur\ucboard\ucterm\ucterm\bin\ucterm.exe'
register_wsl_alias_for_exe stlink 'C:\Program Files (x86)\STMicroelectronics\STM32 ST-LINK Utility\ST-LINK Utility\STM32 ST-LINK Utility.exe'
register_wsl_alias_for_exe eclipse 'C:\Ac6\SystemWorkbench\eclipse.exe'
register_wsl_alias_for_exe openshot-qt 'C:\Program Files\OpenShot Video Editor\openshot-qt.exe'
register_wsl_alias_for_exe fraps 'C:\Fraps\fraps.exe'
register_wsl_alias_for_exe teraterm 'C:\Program Files (x86)\teraterm\ttermpro.exe'
register_wsl_alias_for_exe rgb-light-sense 'C:\Program Files (x86)\RGB Light Sense\RGB Light Sense.exe'
register_wsl_alias_for_exe jlt 'C:\Program Files (x86)\JLT Edge Wireless\OemDrv.exe'
register_wsl_alias_for_exe steam 'C:\Program Files (x86)\Steam\Steam.exe'

alias_if_not_exists eog 'paintdotnet'

# Alias c to "code ." if vscode is installed
if command -v code > /dev/null
then
    alias c="code ."
fi

# Source local shellrc last so that it takes priority
if [ -f $HOME/.local.shellrc ]
then
    source $HOME/.local.shellrc
fi
